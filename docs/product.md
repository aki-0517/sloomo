## プロダクト概要

* **名称 (仮):** Solana Mobile CreditPay
* **目的:** Solana Mobile ネイティブ環境上で、USDC デポジットをベースに QR コード決済および P2P 送金を行い、残高不足の場合は無担保クレジットラインを自動付与して決済を完了させるモバイルアプリを提供する。
* **ターゲットユーザー:**

  * リアル店舗の顧客 (小売店／飲食店)
  * 個人間送金ユーザー
  * 暗号資産を保有しているが流動性不足のライトユーザー
  * 新興市場や銀行口座を持たないユーザー

## コア機能

### 1. USDC デポジット管理

* ウォレット連携：Solana Mobile Wallet Adapter を介してユーザーウォレットに接続
* アプリ内デポジット：ユーザーがアプリに USDC を入金・チャージできる UI
* 残高表示：USDC 残高および利用可能クレジットラインの即時表示

### 2. QR コード決済 / P2P 送金

* **QR コード生成:** 店舗用 QR コード (受信) とユーザー側 QR スキャン (送信) を実装
* **Solana Pay Transfer Request:** QR コード読み取り後、TransferRequest で即時送金
* **決済ステータス:** 送金完了時にオンスクリーンで成功／失敗通知

### 3. 無担保クレジット付与

* **残高不足検知:** 決済時に USDC が不足した場合、自動でクレジットラインをチェック
* **信用スコア計算:**

  * オンチェーン評価: 過去トランザクション頻度、保有資産履歴、ステーキング履歴
  * オフチェーン評価: プロキシ信用情報(例: VantageScore、Plaid ベースの銀行口座データ)
  * ZK 証明: zkTLS / zkCoprocessor によるデータ取得・検証
* **クレジットスマートコントラクト:** 信用評価結果に基づく CL (Credit Line)、APR、返済期日等の発行
* **借入＆返済:** 不足分を即時貸出し、マイクロローンとして返済スケジュールを提示

## アーキテクチャイメージ

1. **フロントエンド (React Native)**

   * Solana Pay Rust ライブラリのラッパー
   * Wallet Adapter 統合コンポーネント
   * QR コード表示・スキャン UI
2. **バックエンド (Serverless / Edge Functions)**

   * 信用スコアリング API Gateway
   * オフチェーン・データ取得 (Plaid, Cred Protocol, Blockchain Bureau)
   * ZK 証明サービス (Reclaim, Lagrange)
3. **スマートコントラクト (Solana Program)**

   * デポジット管理プログラム
   * クレジットラインマネージャー
   * 返済・延滞ロジック

## データ要件

* ユーザーウォレットアドレス
* USDC トークンアカウント残高
* トランザクション履歴 (過去90日～1年)
* 銀行口座残高・入出金履歴 (Plaid)
* オフチェーン信用スコア
* ZK 証明メタデータ

## API / スマートコントラクト仕様

### API エンドポイント

* `POST /api/v1/deposit` : USDC デポジットトランザクションの登録
* `GET /api/v1/balance` : USDC 残高 & クレジットライン情報取得
* `POST /api/v1/score` : 信用スコア算出リクエスト
* `POST /api/v1/loan` : クレジット付与トランザクション
* `POST /api/v1/repay` : 返済トランザクション

### Solana Program

* `initialize_user` : ユーザーアカウント初期化
* `deposit_usdc` : USDC デポジット
* `request_credit_line` : CL 発行<br>- `borrow_usdc` : 借入実行<br>- `repay_usdc` : 返済実行<br>

## UX フロー

1. 初回起動: ウォレット接続 → アカウント初期化
2. USDC 入金: アプリでデポジット→残高表示
3. 決済/送金: QR コードスキャン→金額入力→送信
4. 残高不足: クレジット表示→借入同意→支払い完了
5. 返済管理: 返済スケジュールの確認・自動払い設定

## セキュリティ & プライバシー

* **鍵管理:** キーレストランザクションは全て Wallet Adapter 経由
* **データ暗号化:** 個人情報はエンドツーエンド暗号化・ZK 保護
* **KYC / AML:** 必要に応じて外部 KYC プロバイダ連携
* **スマートコントラクト監査**: セキュリティ監査レポート取得

## テスト & QA

* ユニットテスト: フロントエンド／バックエンド／Solana Program
* 統合テスト: エンドツーエンドフローシミュレーション
* セキュリティテスト: ペネトレーションテスト、スマートコントラクトフォーマル検証

## 今後の展望

* キャッシュフローベース評価モデルへの移行
* AI エージェント向け自動与信
* マルチチェーン対応 (Ethereum, BSC など)
* リワードプログラム連携
